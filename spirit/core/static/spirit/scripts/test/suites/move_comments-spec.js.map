{"version":3,"file":"move_comments-spec.js","sources":["move_comments-spec.coffee"],"names":[],"mappings":"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","sourcesContent":["describe \"move_comments plugin tests\", ->\n    show_move_comments = null\n    plugin_move_comments = null\n\n    isHidden = stModules.utils.isHidden\n\n    beforeEach ->\n        fixtures = jasmine.getFixtures()\n        fixtures.fixturesPath = 'base/test/fixtures/'\n        loadFixtures('move_comments.html')\n\n        show_move_comments = document.querySelectorAll('.js-show-move-comments')\n        plugin_move_comments = stModules.moveComments(show_move_comments, {\n            csrfToken: \"foobar\",\n            target: \"/foo/\"\n        })\n\n    afterEach ->\n        # Fixture will only remove itself not nodes appended to body\n        # so we have to manually remove forms\n        Array.from(document.querySelectorAll('.js-move-comment-form')).forEach((elm) ->\n            elm.parentNode.removeChild(elm)\n        )\n\n    it \"shows the move form on click\", ->\n        expect(isHidden(document.querySelectorAll(\".move-comments\"))).toEqual(true)\n        expect(document.querySelectorAll(\".move-comment-checkbox\").length).toEqual(0)\n\n        show_move_comments[0].click()\n        expect(isHidden(document.querySelectorAll(\".move-comments\"))).toEqual(false)\n        expect(document.querySelectorAll(\".move-comment-checkbox\").length).toEqual(2)\n\n    it \"prevents the default click behaviour on show move comments\", ->\n        evt = document.createEvent(\"HTMLEvents\")\n        evt.initEvent(\"click\", false, true)\n        stopPropagation = spyOn(evt, 'stopPropagation')\n        preventDefault = spyOn(evt, 'preventDefault')\n\n        show_move_comments[0].dispatchEvent(evt)\n        expect(stopPropagation).toHaveBeenCalled()\n        expect(preventDefault).toHaveBeenCalled()\n\n    it \"prevents the default click behaviour on submit\", ->\n        evt = document.createEvent(\"HTMLEvents\")\n        evt.initEvent(\"click\", false, true)\n        stopPropagation = spyOn(evt, 'stopPropagation')\n        preventDefault = spyOn(evt, 'preventDefault')\n\n        submit = spyOn(window.HTMLFormElement.prototype, 'submit')\n        submit.and.callFake( -> )\n\n        document.querySelector(\".js-move-comments\").dispatchEvent(evt)\n        expect(submit.calls.count()).toEqual(1)\n        expect(stopPropagation).toHaveBeenCalled()\n        expect(preventDefault).toHaveBeenCalled()\n\n    it \"submits the form\", ->\n        submit = spyOn(window.HTMLFormElement.prototype, 'submit')\n        submit.and.callFake( -> )\n\n        document.querySelector(\".js-show-move-comments\").click()\n        document.querySelector(\".js-move-comments\").click()\n        form = document.querySelector(\".js-move-comment-form\")\n\n        expect(submit.calls.count()).toEqual(1)\n        expect(form.getAttribute('action')).toEqual(\"/foo/\")\n        expect(isHidden([form])).toEqual(true)\n        expect(form.querySelector(\"input[name=csrfmiddlewaretoken]\").value).toEqual(\"foobar\")\n        expect(form.querySelector(\"input[name=topic]\").value).toEqual(\"10\")\n        expect(form.querySelectorAll(\"input[name=comments]\").length).toEqual(2)\n"]}